{"version":3,"sources":["map_index.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"map_index.js","sourcesContent":["/**\r\n* @fileoverview Manipulating Google Maps API to create \"bikeways\"\r\n*\r\n* @author Marco Gómez\r\n* @version 0.1\r\n*/\r\nvar rutasTemporales=[];\r\nvar map;\r\nvar infowindow;\r\nvar geocoder;\r\nvar markerPosition;\r\nvar circle;\r\nfunction initialize() {\r\n  var myLatLng = new google.maps.LatLng( 20.659699, -103.349609);\r\n  infowindow = new google.maps.InfoWindow();\r\n  //New instantiate Geocoder\r\n  geocoder = new google.maps.Geocoder();\r\n  var infoWindow = new google.maps.InfoWindow({map: map});\r\n  var mapOptions = {\r\n    zoom: 13,\r\n    center: myLatLng,\r\n  };\r\n  map = new google.maps.Map(document.getElementById('map'),\r\n    mapOptions);\r\n  circle = new google.maps.Circle({\r\n    map: map,\r\n    fillColor: '#AA0000'\r\n  });\r\n\r\n  /*RUTAS*/\r\n    $.ajax(\r\n  {\r\n    url : '/api/getAllRoute',\r\n    type: \"GET\",\r\n    success:function(data) \r\n    {\r\n      $parseData=JSON.parse(data);\r\n      $.each($parseData.data, function(i, item) {\r\n        \r\n        for (var i = 0; i < item.paths.length; i++) {\r\n          \r\n        \r\n          var points = google.maps.geometry.encoding.decodePath(item.paths[i].encodepath);\r\n\r\n          var lineSymbol = {\r\n            path: google.maps.SymbolPath.FORWARD_OPEN_ARROW,\r\n            scale: 1.5,\r\n            strokeColor: \"#FFF\",\r\n            strokeOpacity: 1\r\n          };\r\n\r\n          var routePath = new google.maps.Polyline({\r\n            path: points,\r\n            interpolate: true,\r\n            icons: [{\r\n              icon: lineSymbol,\r\n              offset: '50%',\r\n              repeat: '240px'\r\n            }],\r\n            strokeColor: item.color,\r\n            strokeOpacity: 0.7,\r\n            strokeWeight: 4\r\n          });\r\n          google.maps.event.addListener(routePath, 'mouseover', function(event) {\r\n            infowindow.open(map);\r\n            infowindow.setContent(item.name);\r\n            infowindow.setPosition(event.latLng);\r\n          });\r\n          google.maps.event.addListener(routePath, 'mouseout', function() {\r\n              infowindow.close();\r\n          });\r\n          routePath.setMap(map);\r\n          rutasTemporales.push(routePath);\r\n        }\r\n\r\n      });\r\n\r\n    },\r\n    error: function(jqXHR, textStatus, errorThrown) \r\n    {\r\n      console.log(\"No se pudieron cargar los datos\");\r\n    }\r\n  });\r\n    /*CICLOVIAS*/\r\n  $.ajax(\r\n  {\r\n    url : '/api/getAllCiclovia',\r\n    type: \"GET\",\r\n    success:function(data) \r\n    {\r\n      $parseData=JSON.parse(data);\r\n      //console.log($parseData);\r\n      $.each($parseData.data, function(i, item) {\r\n        var points = google.maps.geometry.encoding.decodePath(item.encodepath);\r\n\r\n        var lineSymbol = {\r\n          path: google.maps.SymbolPath.FORWARD_OPEN_ARROW,\r\n          scale: 2.2,\r\n          strokeColor: \"#FFF\",\r\n          strokeOpacity: 1\r\n        };\r\n\r\n        var routePath = new google.maps.Polyline({\r\n          path: points,\r\n          interpolate: true,\r\n          icons: [{\r\n            icon: lineSymbol,\r\n            offset: '50%',\r\n            repeat: '240px'\r\n          }],\r\n          strokeColor: item.color,\r\n          strokeOpacity: 0.7,\r\n          strokeWeight: 8\r\n        });\r\n\r\n\r\n        google.maps.event.addListener(routePath, 'mouseover', function(event) {\r\n          infowindow.open(map);\r\n          infowindow.setContent(item.name);\r\n          infowindow.setPosition(event.latLng);\r\n        });\r\n        google.maps.event.addListener(routePath, 'mouseout', function() {\r\n            infowindow.close();\r\n        });\r\n        routePath.setMap(map);\r\n        rutasTemporales.push(routePath);\r\n\r\n      });\r\n\r\n    },\r\n    error: function(jqXHR, textStatus, errorThrown) \r\n    {\r\n      console.log(\"No se pudieron cargar los datos\");\r\n    }\r\n  });\r\n\r\n  // Try HTML5 geolocation.\r\n  if (navigator.geolocation) {\r\n    navigator.geolocation.getCurrentPosition(function(position) {\r\n      var pos = {\r\n        lat: position.coords.latitude,\r\n        lng: position.coords.longitude\r\n      };\r\n\r\n      markerPosition = new google.maps.Marker({\r\n        position: pos,\r\n        map: map,\r\n        draggable: true,\r\n        title: 'Su ubicaciónn!',\r\n        myData: 'originNear'\r\n      });\r\n      markerPosition.addListener('dragend', moveMarkerEvent);\r\n      getStreetName(pos, \"originNear_formatted_address\");\r\n      document.getElementById('originNear_lat').value=position.coords.latitude;\r\n      document.getElementById('originNear_lng').value=position.coords.longitude;\r\n      map.setCenter(pos);\r\n    }, function() {\r\n      handleLocationError(true, infoWindow, map.getCenter());\r\n    });\r\n  } else {\r\n    // Browser doesn't support Geolocation\r\n    handleLocationError(false, infoWindow, map.getCenter());\r\n  }\r\n}\r\nfunction handleLocationError(browserHasGeolocation, infoWindow, pos) {\r\n  infoWindow.setPosition(pos);\r\n  infoWindow.setContent(browserHasGeolocation ?\r\n                        'Error: The Geolocation service failed.' :\r\n                        'Error: Your browser doesn\\'t support geolocation.');\r\n}\r\n/*\r\n * Get street name from position\r\n*/\r\nfunction getStreetName(position, IDInput) {\r\n  geocoder.geocode({'latLng': position}, function(results, status) {\r\n    if (status == google.maps.GeocoderStatus.OK) {\r\n      if (results[1]) {\r\n         document.getElementById(IDInput).value = results[0].formatted_address;\r\n      } else {\r\n         document.getElementById(IDInput).value = \"-\";\r\n         console.log(\"fail\");\r\n      }\r\n    } else {\r\n       document.getElementById(IDInput).value  = \"-\";\r\n       console.log(\"fail geocoder\");\r\n    }\r\n  });\r\n}\r\nfunction moveMarkerEvent(event) {\r\n  var idMarker=this.myData+'_';\r\n  //Update form inputs\r\n  document.getElementById(idMarker+'lat').value = event.latLng.lat();\r\n  document.getElementById(idMarker+'lng').value = event.latLng.lng();\r\n  document.getElementById(idMarker+'formatted_address').value = event.formatted_address;\r\n  getStreetName(event.latLng, idMarker+'formatted_address');\r\n}\r\n\r\n/**\r\n * Submit form\r\n * @param {Object} form\r\n * @return {boolean}\r\n */\r\n function submit_form(form) {\r\n  var serializeArray = new FormData(form);\r\n\r\n  $.ajax({\r\n    url: form.action,\r\n    type: form.method,\r\n    data : serializeArray,\r\n    cache:false,\r\n    contentType: false,\r\n    processData: false,\r\n    success: function(data){\r\n\r\n      /*Quitar todas las rutas actuales del mapa*/\r\n      for (i=0; i<rutasTemporales.length; i++) \r\n      {                           \r\n        rutasTemporales[i].setMap(null); //or line[i].setVisible(false);\r\n      }\r\n      rutasTemporales=[];\r\n      $parseData=JSON.parse(data);\r\n      $.each($parseData.data, function(i, item) {\r\n        for (var i = 0; i < item.paths.length; i++) {\r\n          var points = google.maps.geometry.encoding.decodePath(item.paths[i].encodepath);\r\n\r\n          var lineSymbol = {\r\n            path: google.maps.SymbolPath.FORWARD_OPEN_ARROW,\r\n            scale: 2.2,\r\n            strokeColor: \"#FFF\",\r\n            strokeOpacity: 1\r\n          };\r\n\r\n          var routePath = new google.maps.Polyline({\r\n            path: points,\r\n            interpolate: true,\r\n            icons: [{\r\n              icon: lineSymbol,\r\n              offset: '50%',\r\n              repeat: '240px'\r\n            }],\r\n            strokeColor: item.color,\r\n            strokeOpacity: 0.7,\r\n            strokeWeight: 8\r\n          });\r\n          google.maps.event.addListener(routePath, 'mouseover', function(event) {\r\n            infowindow.open(map);\r\n            infowindow.setContent(item.name);\r\n            infowindow.setPosition(event.latLng);\r\n          });\r\n          google.maps.event.addListener(routePath, 'mouseout', function() {\r\n            infowindow.close();\r\n          });\r\n          routePath.setMap(map);\r\n          rutasTemporales.push(routePath);\r\n        }\r\n      });\r\n    },\r\n    error: function (response) {\r\n      console.log(\"fail\");\r\n      console.log(response);\r\n    }\r\n  });\r\n  return false;\r\n }\r\n function draw_circle(){\r\n  var rango= parseInt(document.getElementById('rango').value);\r\n// Add circle overlay and bind to marker\r\n  circle.setRadius(rango);\r\n  circle.bindTo('center', markerPosition, 'position');\r\n  if(circle.getMap() == null) circle.setMap(map);\r\n }\r\ngoogle.maps.event.addDomListener(window, 'load', initialize);\r\n\r\n$( \"#rango\" ).change(function() {\r\n  draw_circle();\r\n});"]}